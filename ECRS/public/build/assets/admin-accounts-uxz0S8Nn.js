$(document).ready(function(){const n=document.querySelector("#myTable");if(n){let d=function(){const t=[];return s.rows().every(function(){const e=$(this.node()),o=e.find('input[type="checkbox"].prof_checkbox');if(o.prop("checked")&&!o.prop("disabled")){const r=e.find('input[type="checkbox"]').data("prof-id");r&&t.push(r)}}),[...new Set(t)]},i=function(){const t=d();$("#selectedProfIDs").text(t.join(", "))};var c=d,m=i;const s=$(n).DataTable({processing:!0,serverSide:!0,ajax:{url:"/get-faculty-acc"},type:"GET",dataType:"json",columns:[{data:"schoolIDNo"},{data:"Lname"},{data:"Fname"},{data:"email"},{data:null,render:function(t,a,e){return`
                            <div class="flex justify-center items-center gap-1 text-xl">
                                <div class="relative group flex justify-center items-center">
                                    <i class="fa-solid fa-eye text-blue-500 hover:bg-gray-200 dark:hover:bg-[#161616] p-[5px] hover:rounded-md cursor-pointer" data-salutation="${e.salutation}" data-schoolID="${e.schoolIDNo}" data-fname="${e.Fname}" data-id="${e.id}" data-lname="${e.Lname}" data-mname="${e.Mname}" data-sname="${e.Sname}"  
                         data-email="${e.email}"></i>
                            <div
                                class="absolute top-[-65px] left-1/2 transform hidden group-hover:block -translate-x-1/2">
                                <div
                                    class="flex justify-center items-center text-center transition-all duration-300 relative">
                                    <span class="p-2 text-sm text-white bg-[#404040] shadow-lg rounded-md">View Info</span>
                                    <div
                                        class="absolute bottom-[-8px] left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-[#404040]">
                                    </div>
                                </div>
                            </div>
                        </div>
                                <div class="relative group flex justify-center items-center">
                                    <i class="fa-solid fa-pen-to-square text-green-500 edit-button hover:bg-gray-200 dark:hover:bg-[#161616] p-[5px] hover:rounded-md cursor-pointer" data-id="${e.id}" data-salutation="${e.salutation}" data-schoolID="${e.schoolIDNo}" data-fname="${e.Fname}" data-lname="${e.Lname}" data-mname="${e.Mname}" data-sname="${e.Sname}" data-email="${e.email}"></i>
                                    <div
                                class="absolute top-[-65px] left-1/2 transform hidden group-hover:block -translate-x-1/2">
                                <div
                                    class="flex justify-center items-center text-center transition-all duration-300 relative">
                                    <span class="p-2 text-sm text-white bg-[#404040] shadow-lg rounded-md">Edit Info</span>
                                    <div
                                        class="absolute bottom-[-8px] left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-[#404040]">
                                    </div>
                                </div>
                            </div>
                                </div>
                               
                            </div>`}}],responsive:!0,pagingType:"simple",paging:!0,order:[],lengthMenu:[10,25,50],columnDefs:[{targets:0,orderable:!1}]});$("#add-prof-form").on("submit",function(t){t.preventDefault();const a=new FormData(this);$("#add-cre-send-email-loader").removeClass("hidden"),$("body").addClass("no-scroll"),$.ajax({url:"/save-prof-info",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"POST",data:a,contentType:!1,processData:!1,success:function(e){e.success?Swal.fire({title:"Success!",text:e.message,icon:"success",confirmButtonText:"OK"}).then(o=>{o.isConfirmed&&(s.ajax.reload(),$("#add-prof-form")[0].reset(),$("#add-prof-modal").fadeOut())}):Swal.fire({title:"Error!",text:e.message,icon:"error",confirmButtonText:"OK"})},error:function(e){let o="An error occurred.";if(e.status===422){let r=e.responseJSON.errors;r.email&&(o=r.email[0])}else e.status===400&&(o=e.responseJSON.message);Swal.fire({title:"Error!",text:o,icon:"error",confirmButtonText:"OK"}),$("#add-prof-form")[0].reset(),$("#add-cre-send-email-loader").addClass("hidden"),$("body").removeClass("no-scroll")},complete:function(){$("#add-cre-send-email-loader").addClass("hidden"),$("body").removeClass("no-scroll")}})}),$("#edit-prof-form").on("submit",function(t){t.preventDefault();const a={registrationID:$("#edit-registrationID").val(),schoolIDNo:$("#edit-schoolIDNo").val(),Fname:$("#edit-Fname").val(),Lname:$("#edit-Lname").val(),Mname:$("#edit-Mname").val(),Sname:$("#edit-Sname").val(),email:$("#edit-email").val(),salutation:$("#edit-salutation").val(),_token:$('meta[name="csrf-token"]').attr("content")};$.ajax({url:"/professor-update",method:"PUT",data:a,success:function(e){Swal.fire({title:"Success!",text:e.message,icon:"success",confirmButtonText:"OK"}).then(o=>{o.isConfirmed&&($("#edit-prof-modal").fadeOut(),s.ajax.reload())})},error:function(e){let o="An unexpected error occurred.";if(e.status===422){const r=e.responseJSON.errors;o=Object.values(r).map(l=>l.join(" ")).join(`
`)}else e.responseJSON&&e.responseJSON.message&&(o=e.responseJSON.message);Swal.fire({title:"Error!",text:o,icon:"error",confirmButtonText:"OK"})}})}),$(document).on("submit","#add-prof-list-form",function(t){t.preventDefault(),$("#loader-modal-import").removeClass("hidden"),$("body").addClass("no-scroll");var a=new FormData(this);$.ajax({url:"/import-professor",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"POST",data:a,contentType:!1,processData:!1,success:function(e){Swal.fire({title:"Success!",text:e.message,icon:"success",confirmButtonText:"OK"}).then(o=>{o.isConfirmed&&(s.ajax.reload(),$("#add-prof-list-form")[0].reset(),$("#add-prof-list-modal").fadeOut())})},error:function(e,o,r){Swal.fire({title:"Error!",text:"An error occurred: "+r,icon:"error",confirmButtonText:"OK"})},complete:function(){$("#loader-modal-import").addClass("hidden"),$("body").removeClass("no-scroll")}})}),$(document).on("click",".send-credentials",function(){var t=$(this).data("fname"),a=$(this).data("salutation"),e=$(this).data("lname"),o=$(this).data("email");Swal.fire({title:"Send Account Credentials?",text:`Send account credentials to ${a} ${t} ${e} (${o})`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, send it!",cancelButtonText:"No, cancel"}).then(r=>{$("#send-email-loader").removeClass("hidden"),$("body").addClass("no-scroll"),r.isConfirmed?$.ajax({url:"/send-faculty-credentials",method:"POST",data:{fname:t,lname:e,email:o,salutation:a,_token:$('meta[name="csrf-token"]').attr("content")},success:function(l){l.success?setTimeout(function(){Swal.fire({title:"Sent!",text:l.message,icon:"success",confirmButtonText:"OK"}).then(()=>{s.ajax.reload()})},500):Swal.fire("Error","There was an issue sending the credentials.","error")},error:function(){Swal.fire("Error","There was an issue with the request.","error")},complete:function(){$("#send-email-loader").addClass("hidden"),$("body").removeClass("no-scroll")}}):($("#send-email-loader").addClass("hidden"),$("body").removeClass("no-scroll"))})}),$(".send-batch-prof-credentials").click(function(){const t=d();if($("#selectedProfIDs").val(t),t.length===0){Swal.fire({title:"Error!",text:"Please select at least one professor.",icon:"error",confirmButtonText:"OK"});return}Swal.fire({title:"Send Account Credentials?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, send it!",cancelButtonText:"No, cancel"}).then(a=>{$("#send-email-loader").removeClass("hidden"),$("body").addClass("no-scroll"),a.isConfirmed?$.ajax({url:"/send-faculty-credentials-batch",method:"POST",data:{selectedProfIDs:t,_token:$('meta[name="csrf-token"]').attr("content")},success:function(e){setTimeout(function(){Swal.fire({title:"Success!",text:e.message,icon:"success",confirmButtonText:"OK"}).then(()=>{s.ajax.reload()})},500)},error:function(e){console.error("Error sending notification:",e),setTimeout(function(){Swal.fire({title:"Error!",text:e.responseJSON?e.responseJSON.message:"An error occurred while sending the notification.",icon:"error",confirmButtonText:"OK"})},500)},complete:function(){$("#send-email-loader").addClass("hidden"),$("body").removeClass("no-scroll")}}):($("#send-email-loader").addClass("hidden"),$("body").removeClass("no-scroll"))})}),$("#prof_select_all").on("click",function(){const t=this.checked;t?s.page.len(-1).draw():s.page.len(10).draw(),s.rows().every(function(){$(this.node()).find('input[type="checkbox"].prof_checkbox:not(:disabled)').prop("checked",t)}),i()}),$("#myTable").on("change",'input[type="checkbox"].prof_checkbox',function(){i();const t=s.rows().count(),a=d().length,e=$("#prof_select_all").get(0);a===t?(e.checked=!0,e.indeterminate=!1):a===0?(e.checked=!1,e.indeterminate=!1):e.indeterminate=!0})}$("#add-prof-btn").on("click",function(){$("#add-prof-modal").show(),$("body").addClass("no-scroll")}),$("#close-btn-add-prof").on("click",function(){$("#add-prof-modal").fadeOut(),$("body").removeClass("no-scroll")}),$("#add-prof-list-btn").on("click",function(){$("#add-prof-list-modal").show(),$("body").addClass("no-scroll")}),$("#close-btn-add-prof-list").on("click",function(){$("#add-prof-list-modal").fadeOut(),$("body").removeClass("no-scroll")})});$(document).on("click",".fa-eye",function(){const n=this.getAttribute("data-salutation"),c=this.getAttribute("data-fname"),m=this.getAttribute("data-lname"),s=this.getAttribute("data-mname"),d=this.getAttribute("data-sname"),i=this.getAttribute("data-email"),t=this.getAttribute("data-schoolID");document.getElementById("view-salutation").textContent=n,document.getElementById("view-Fname").textContent=c,document.getElementById("view-Lname").textContent=m,document.getElementById("view-Mname").textContent,document.getElementById("view-Sname").textContent,document.getElementById("view-email").textContent=i,document.getElementById("view-schoolIDNo").textContent=t,$("#view-prof-modal").show(),$("body").addClass("no-scroll")});$("#close-btn-view-prof").on("click",function(){$("#view-prof-modal").fadeOut(),$("body").removeClass("no-scroll")});$("#close-btn-edit-prof").on("click",function(){$("#edit-prof-modal").fadeOut(),$("body").removeClass("no-scroll")});$(document).on("click",".edit-button",function(){const n=$(this).data();$("#edit-prof-modal #edit-registrationID").val(n.id),$("#edit-prof-modal #edit-Fname").val(n.fname),$("#edit-prof-modal #edit-Lname").val(n.lname),$("#edit-prof-modal #edit-Mname").val(n.mname),$("#edit-prof-modal #edit-Sname").val(n.sname),$("#edit-prof-modal #edit-schoolIDNo").val(n.schoolid),$("#edit-prof-modal #edit-email").val(n.email),$("#edit-prof-modal #edit-salutation").val(n.salutation),$("#edit-prof-modal").show(),$("body").addClass("no-scroll")});
