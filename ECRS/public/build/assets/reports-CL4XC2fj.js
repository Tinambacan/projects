$(document).ready(function(){$("#classRecordsTable").DataTable({stateSave:!0,ordering:!1,responsive:!0,pagingType:"simple",lengthMenu:[10,25,50],columnDefs:[{targets:"_all",orderable:!1}],initComplete:function(){$("#classRecordsTable tbody tr").removeClass("selected")}})});$(document).ready(function(){const n=document.querySelector("#toVerifyTable");n&&$(n).DataTable({processing:!0,serverSide:!0,responsive:!0,pagingType:"simple",paging:!0,order:[],columnDefs:[{targets:[3,4],orderable:!1}],ajax:{url:"/get-admin-classrec-reports",method:"GET",dataSrc:"data",dataType:"json",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}},columns:[{data:"professorName",className:"text-center",render:e=>e||"N/A"},{data:"programTitle",className:"text-center",render:e=>e||"N/A"},{data:"courseTitle",className:"text-center",render:e=>e||"N/A"},{data:"status",className:"text-center",render:e=>e==="Submitted"?'<span class="bg-green-500 text-white p-2 rounded-md">Submitted</span>':'<span class="bg-red-500 text-white p-2 rounded-md">Unsubmitted</span>'},{data:null,className:"text-center",render:e=>{const r=e.status==="Unsubmitted"?`
                                <div class="relative group flex justify-center items-center">
                                    <i class="fa-solid fa-bell text-yellow-500 notif-prof hover:bg-gray-200 dark:hover:bg-[#161616] p-[5px]  rounded-md cursor-pointer text-xl" 
                                        data-prof-id="${e.profID}" 
                                        data-course="${e.courseTitle}" 
                                        data-prof-name="${e.professorName}" 
                                        data-class-record="${e.classRecordID}">
                                    </i>
                                    <div
                                        class="absolute top-[-65px] left-1/2 transform hidden group-hover:block -translate-x-1/2">
                                        <div
                                            class="flex justify-center items-center text-center transition-all duration-300 relative">
                                            <span class="p-2 text-sm text-white bg-[#404040] shadow-lg rounded-md">Notify Professor</span>
                                            <div
                                                class="absolute bottom-[-8px] left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-[#404040]">
                                            </div>
                                        </div>
                                    </div>
                                </div>`:'<i class="fa-solid fa-bell text-gray-500 text-xl"></i>',l=e.status==="Submitted"?`
                                <div class="relative group flex justify-center items-center">
                                    <i class="fa-solid fa-download text-green-500 download-file hover:bg-gray-200 dark:hover:bg-[#161616] p-[5px]  rounded-md cursor-pointer text-xl" 
                                        data-fileID="${e.fileID}" 
                                        >
                                    </i>
                                    <div
                                        class="absolute top-[-65px] left-1/2 transform hidden group-hover:block -translate-x-1/2">
                                        <div
                                            class="flex justify-center items-center text-center transition-all duration-300 relative">
                                            <span class="p-2 text-sm text-white bg-[#404040] shadow-lg rounded-md">Download File</span>
                                            <div
                                                class="absolute bottom-[-8px] left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-[#404040]">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    `:'<i class="fa-solid fa-download  text-gray-500 text-xl"></i>';return`
                        <div class="flex justify-center items-center gap-2 text-2xl">
                            ${r}
                            ${l}
                        </div>
                        `}}]});const t=document.querySelector("#verifiedTable");t&&$(t).DataTable({responsive:!0,pagingType:"simple",paging:!0,order:[]});const o=document.querySelector("#submittedTable");o&&$(o).DataTable({responsive:!0,pagingType:"simple",paging:!0,order:[]});const s=document.querySelector("#facultyVerifiedTable");s&&$(s).DataTable({responsive:!0,pagingType:"simple",paging:!0,order:[]}),$(document).ready(function(){$(document).on("click",".submit-button",function(){const e=$(this).data("file-id");a(e)})});function a(e){const r=$("#report-form-"+e);if(r.length){const l=r.serialize();$.ajax({url:r.attr("action"),method:"POST",data:l,headers:{"X-Requested-With":"XMLHttpRequest"},success:function(i){i.status==="success"?window.location.href=i.redirect_url:alert(i.message)},error:function(i){console.error("AJAX request failed:",i)}})}else console.error("Form not found for fileID:",e)}});$(document).ready(function(){$("#verify-print-form").on("submit",function(n){n.preventDefault(),$.ajax({url:$(this).attr("action"),type:"POST",data:$(this).serialize(),headers:{"X-CSRF-TOKEN":$("meta[name='csrf-token']").attr("content")},success:function(t){t.success?Swal.fire({title:"Success!",text:t.message,icon:"success",confirmButtonColor:"#3085d6"}).then(()=>{}):Swal.fire({title:"Error!",text:t.message,icon:"error",confirmButtonColor:"#3085d6"})},error:function(t,o,s){console.error("Error:",s),Swal.fire({title:"Error!",text:"An error occurred  while updating the file.",icon:"error",confirmButtonColor:"#3085d6"})}})})});$(document).ready(function(){$("#verify-print-btn").on("click",function(n){n.preventDefault(),Swal.fire({title:"Are you sure?",text:"Do you want to verify and print this file?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, verify it!",cancelButtonText:"No, cancel!"}).then(t=>{t.isConfirmed?$.ajax({url:$("#verify-print-form").attr("action"),type:"POST",data:$("#verify-print-form").serialize(),success:function(o){Swal.fire("Verified!","The file has been verified and printed.","success").then(()=>{window.location.href="/admin/reports/verified"})},error:function(o){Swal.fire("Error!","There was an error verifying the file.","error")}}):t.dismiss===Swal.DismissReason.cancel&&Swal.fire("Cancelled","Your action has been cancelled :)","info")})}),$(document).on("click",".notif-prof",function(n){const t=$(this).data("prof-id"),o=$(this).data("course"),s=$(this).data("class-record"),a=$(this).data("prof-name");Swal.fire({title:"Notify Professor",html:`Do you want to send a notice to <strong>${a}</strong> for the course: <strong>${o}</strong>?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"Cancel"}).then(e=>{e.isConfirmed&&$.ajax({url:"/notify-professor",type:"POST",data:{professor_id:t,course:o,classRecordID:s,_token:$('meta[name="csrf-token"]').attr("content")},success:function(r){Swal.fire({icon:"success",title:"Notification Sent",text:r.message,showConfirmButton:!1,timer:2e3})},error:function(r,l,i){Swal.fire({icon:"error",title:"Error",text:"Failed to notify the professor!"})}})})}),$(document).on("click",".download-file",function(){const n=$(this).data("fileid");Swal.fire({title:"Download File",text:"Are you sure you want to download this file?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Download",cancelButtonText:"Cancel"}).then(t=>{t.isConfirmed&&$.ajax({url:`/download-file/${n}`,type:"GET",xhrFields:{responseType:"blob"},success:function(o,s,a){const e=a.getResponseHeader("Content-Disposition")?a.getResponseHeader("Content-Disposition").split("filename=")[1].replace(/"/g,""):"downloaded_file",r=document.createElement("a");r.href=window.URL.createObjectURL(o),r.download=e,r.click(),window.URL.revokeObjectURL(r.href)},error:function(o,s,a){Swal.fire({icon:"error",title:"Error",text:"Failed to download the file!"})}})})})});
