$(document).ready(function(){var i=document.getElementById("students-chart").getContext("2d"),p=new Chart(i,{type:"doughnut",data:{labels:["Passed","Failed"],datasets:[{data:[0,0],backgroundColor:["#4CAF50","#F44336"],borderColor:["#fff","#fff"],borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"top"},tooltip:{callbacks:{label:function(e){return e.label+": "+e.raw}}}}}}),f=document.getElementById("students-chart-bar").getContext("2d"),u=new Chart(f,{type:"bar",data:{labels:["Passed","Failed"],datasets:[{label:"Number of Students",data:[0,0],backgroundColor:["#4CAF50","#F44336"],borderColor:["#fff","#fff"],borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"top"},tooltip:{callbacks:{label:function(e){return e.label+": "+e.raw}}}},scales:{x:{stacked:!0},y:{beginAtZero:!0,stacked:!0}}}});function m(e){$.ajax({url:"/get-class-records-dashboard/"+e,type:"GET",dataType:"json",success:function(t){if($("#course-selector").empty().append('<option value="">Select Course</option>'),$("#acad-selector").empty().append('<option value="">Select Academic Year</option>'),$("#sem-selector").empty().append('<option value="">Select Semester</option>'),$("#program-selector").empty().append('<option value="">Select Program</option>'),$("#total-students").text("0"),t.classRecords){const a=new Map;$.each(t.classRecords,function(s,o){a.has(o.courseId)||a.set(o.courseId,o.courseName)}),a.forEach((s,o)=>{$("#course-selector").append('<option value="'+o+'">'+s+"</option>")})}},error:function(){}})}function v(e){$("#acad-selector").empty().append('<option value="">Select Academic Year</option>'),e.forEach(function(t){$("#acad-selector").append('<option value="'+t+'">'+t+"</option>")})}function g(e){$("#sem-selector").empty().append('<option value="">Select Semester</option>'),e.forEach(function(t){$("#sem-selector").append('<option value="'+t+'">'+(t==1?"First":t==2?"Second":"Summer")+"</option>")})}function h(e){$("#program-selector").empty().append('<option value="">Select Program</option>'),e.forEach(function(t){$("#program-selector").append('<option value="'+t.programId+'">'+t.programName+"</option>")})}function x(e){var t=$("#prof-selector").val();t&&e?$.ajax({url:"/get-class-records-by-course-and-semester",type:"GET",dataType:"json",data:{courseId:e,professorId:t},success:function(a){var s=new Set,o=new Set;$.each(a.classRecords,function(d,r){s.add(r.schoolYear),o.add(r.semester)}),v(Array.from(s)),g(Array.from(o)),$("#total-students").text("0")}}):($("#acad-selector").empty().append('<option value="">Select Academic Year</option>'),$("#sem-selector").empty().append('<option value="">Select Semester</option>'),$("#total-students").text("0"))}function y(e,t,a){var s=$("#prof-selector").val();$.ajax({url:"/get-class-records-by-course-semester-school-year",type:"GET",dataType:"json",data:{courseId:e,semester:t,schoolYear:a,professorId:s},success:function(o){if(o.classRecords){var d=o.classRecords.map(function(c){return{programId:c.programId,programName:c.programName}});h(d);var r=0,n=0,l=0;o.classRecords.forEach(function(c){r+=c.totalStudents,n+=c.passed,l+=c.failed}),$("#total-students").text(r||"0"),$("#passed-count").text(n||"0"),$("#failed-count").text(l||"0"),p.data.datasets[0].data=[n,l],p.update(),u.data.datasets[0].data=[n,l],u.update()}},error:function(o,d,r){console.error("AJAX Error:",d,r),$("#total-students").text("0"),$("#passed-count").text("0"),$("#failed-count").text("0")}})}function b(e,t,a,s,o){e&&t&&a&&s&&o?$.ajax({url:"/get-class-records-dashboard/"+e,type:"GET",dataType:"json",data:{courseId:t,academicYear:a,semester:s,programId:o},success:function(d){var r=0,n=0,l=0;d.classRecords&&d.classRecords.forEach(function(c){r+=c.totalStudents,n+=c.passed,l+=c.failed}),$("#total-students").text(r||"0"),$("#passed-count").text(n||"0"),$("#failed-count").text(l||"0"),p.data.datasets[0].data=[n,l],p.update(),u.data.datasets[0].data=[n,l],u.update()},error:function(){$("#total-students").text("0"),$("#passed-count").text("0"),$("#failed-count").text("0")}}):($("#total-students").text("0"),$("#passed-count").text("0"),$("#failed-count").text("0"))}$("#course-selector").on("change",function(){var e=$(this).val();x(e),$("#total-students").text("0"),$("#passed-count").text("0"),$("#failed-count").text("0")}),$("#prof-selector").on("change",function(){var e=$(this).val();e?m(e):($("#course-selector").empty().append('<option value="">Select Course</option>'),$("#acad-selector").empty().append('<option value="">Select Academic Year</option>'),$("#sem-selector").empty().append('<option value="">Select Semester</option>'),$("#program-selector").empty().append('<option value="">Select Program</option>'),$("#total-students").text("0"),$("#passed-count").text("0"),$("#failed-count").text("0"))}),$("#acad-selector, #sem-selector").on("change",function(){var e=$("#course-selector").val(),t=$("#sem-selector").val(),a=$("#acad-selector").val();y(e,t,a)}),$("#acad-selector, #sem-selector, #program-selector").on("change",function(){var e=$("#prof-selector").val(),t=$("#course-selector").val(),a=$("#acad-selector").val(),s=$("#sem-selector").val(),o=$("#program-selector").val();b(e,t,a,s,o)})});
