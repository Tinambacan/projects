$(document).ready(function(){const s=document.querySelector("#myTable");if(s){let i=function(){const t=[];return a.rows().every(function(){const e=$(this.node()),o=e.find('input[type="checkbox"].admin_checkbox');if(o.prop("checked")&&!o.prop("disabled")){const d=e.find('input[type="checkbox"]').data("admin-id");d&&t.push(d)}}),[...new Set(t)]},r=function(){const t=i();$("#selectedAdminIDs").text(t.join(", "))};var c=i,m=r;const a=$(s).DataTable({processing:!0,serverSide:!0,ajax:{url:"/get-admin-acc",type:"GET",dataType:"json",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}},columns:[{data:"Fname"},{data:"Lname"},{data:"email"},{data:null,render:function(t,n,e){return`
                            <div class="flex justify-center items-center gap-1 text-xl">
                                <div class="relative group flex justify-center items-center">
                                    <i class="fa-solid fa-eye text-blue-500 hover:bg-gray-200 hover:rounded-md p-1 cursor-pointer" data-salutation="${e.salutation}" data-schoolID="${e.schoolIDNo}" data-fname="${e.Fname}" data-id="${e.id}" data-lname="${e.Lname}" data-mname="${e.Mname}" data-sname="${e.Sname}" data-branch="${e.branch}" 
                        data-branch-description="${e.branchDescription}" data-email="${e.email}"></i>
                                    <div
                                class="absolute top-[-65px] left-1/2 transform hidden group-hover:block -translate-x-1/2">
                                <div
                                    class="flex justify-center items-center text-center transition-all duration-300 relative">
                                    <span class="p-2 text-sm text-white bg-[#404040] shadow-lg rounded-md">View Info</span>
                                    <div
                                        class="absolute bottom-[-8px] left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-[#404040]">
                                    </div>
                                </div>
                            </div>
                        </div>
                                <div class="relative group flex justify-center items-center">
                                    <i class="fa-solid fa-pen-to-square text-green-500 edit-button hover:bg-gray-200 hover:rounded-md p-1 cursor-pointer" data-adminID="${e.id}" data-salutation="${e.salutation}" data-schoolID="${e.schoolIDNo}" data-fname="${e.Fname}" data-lname="${e.Lname}" data-mname="${e.Mname}" data-sname="${e.Sname}" data-email="${e.email}"></i>
                                    <div
                                class="absolute top-[-65px] left-1/2 transform hidden group-hover:block -translate-x-1/2">
                                <div
                                    class="flex justify-center items-center text-center transition-all duration-300 relative">
                                    <span class="p-2 text-sm text-white bg-[#404040] shadow-lg rounded-md">Edit Info</span>
                                    <div
                                        class="absolute bottom-[-8px] left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-[#404040]">
                                    </div>
                                </div>
                            </div>
                                </div>
                                
                            </div>`}}],responsive:!0,pagingType:"simple",paging:!0,order:[],pageLength:10,lengthMenu:[10,25,50],columnDefs:[{targets:0,orderable:!1}]});$('input[type="checkbox"].admin_checkbox').prop("checked",!1),$("#admin_select_all").prop("checked",!1).prop("indeterminate",!1),$("#admin_select_all").on("click",function(){const t=this.checked;t?a.page.len(-1).draw():a.page.len(10).draw(),a.rows().every(function(){$(this.node()).find('input[type="checkbox"].admin_checkbox:not(:disabled)').prop("checked",t)}),r()}),$("#myTable").on("change",'input[type="checkbox"].admin_checkbox',function(){r();const t=a.rows().count(),n=i().length,e=$("#admin_select_all").get(0);n===t?(e.checked=!0,e.indeterminate=!1):n===0?(e.checked=!1,e.indeterminate=!1):e.indeterminate=!0}),$(document).on("submit","#add-admin-list-form",function(t){t.preventDefault(),$("#loader-modal-import").removeClass("hidden"),$("body").addClass("no-scroll");var n=new FormData(this);$.ajax({url:"/import-admin",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"POST",data:n,contentType:!1,processData:!1,success:function(e){Swal.fire({title:"Success!",text:e.message,icon:"success",confirmButtonText:"OK"}).then(o=>{o.isConfirmed&&a.ajax.reload()})},error:function(e,o,d){Swal.fire({title:"Error!",text:"An error occurred: "+d,icon:"error",confirmButtonText:"OK"})},complete:function(){$("#loader-modal-import").fadeOut(),$("body").removeClass("no-scroll")}})}),$("#edit-admin-form").on("submit",function(t){t.preventDefault();const n=$(this).serialize();$.ajax({url:"admin-update",method:"POST",data:n,success:function(e){Swal.fire({title:"Success!",text:e.message,icon:"success",confirmButtonText:"OK"}).then(o=>{o.isConfirmed&&($("#edit-admin-modal").fadeOut(),a.ajax.reload())})},error:function(e){alert("Error: "+e.responseText)}})}),$("#add-admin-form").on("submit",function(t){t.preventDefault();const n=new FormData(this);$("#add-cre-send-email-loader").removeClass("hidden"),$("body").addClass("no-scroll"),$.ajax({url:"/save-admin-info",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"POST",data:n,contentType:!1,processData:!1,success:function(e){e.success?Swal.fire({title:"Success!",text:e.message,icon:"success",confirmButtonText:"OK"}).then(o=>{o.isConfirmed&&(a.ajax.reload(),$("#add-admin-form")[0].reset(),$("#add-admin-modal").fadeOut())}):Swal.fire({title:"Error!",text:e.message,icon:"error",confirmButtonText:"OK"})},error:function(e){let o="An error occurred.";if(e.status===422){let d=e.responseJSON.errors;d.email&&(o=d.email[0])}else e.status===400&&(o=e.responseJSON.message);Swal.fire({title:"Error!",text:o,icon:"error",confirmButtonText:"OK"}),$("#add-admin-form")[0].reset(),$("#add-cre-send-email-loader").fadeOut(),$("body").removeClass("no-scroll")},complete:function(){$("#add-cre-send-email-loader").addClass("hidden"),$("body").removeClass("no-scroll")}})}),$(".send-batch-admin-credentials").click(function(){const t=i();if($("#selectedAdminIDs").val(t),t.length===0){Swal.fire({title:"Error!",text:"Please select at least one admin.",icon:"error",confirmButtonText:"OK"});return}Swal.fire({title:"Send Account Credentials?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, send it!",cancelButtonText:"No, cancel"}).then(n=>{$("#send-email-loader").removeClass("hidden"),$("body").addClass("no-scroll"),n.isConfirmed?$.ajax({url:"/send-admin-credentials-batch",method:"POST",data:{selectedAdminIDs:t,_token:$('meta[name="csrf-token"]').attr("content")},success:function(e){setTimeout(function(){Swal.fire({title:"Success!",text:e.message,icon:"success",confirmButtonText:"OK"}).then(()=>{a.ajax.reload()})},500)},error:function(e){console.error("Error sending notification:",e),setTimeout(function(){Swal.fire({title:"Error!",text:e.responseJSON?e.responseJSON.message:"An error occurred while sending the notification.",icon:"error",confirmButtonText:"OK"})},500)},complete:function(){$("#send-email-loader").addClass("hidden"),$("body").removeClass("no-scroll")}}):($("#send-email-loader").addClass("hidden"),$("body").removeClass("no-scroll"))})}),$(document).on("click",".send-credentials",function(){var t=$(this).data("fname"),n=$(this).data("salutation"),e=$(this).data("lname"),o=$(this).data("email");Swal.fire({title:"Send Account Credentials?",text:`Send account credentials to ${n} ${t} ${e} (${o})`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, send it!",cancelButtonText:"No, cancel"}).then(d=>{$("#send-email-loader").removeClass("hidden"),$("body").addClass("no-scroll"),d.isConfirmed?$.ajax({url:"/send-admin-credentials",method:"POST",data:{fname:t,lname:e,email:o,salutation:n,_token:$('meta[name="csrf-token"]').attr("content")},success:function(u){u.success?setTimeout(function(){Swal.fire({title:"Sent!",text:u.message,icon:"success",confirmButtonText:"OK"}).then(()=>{a.ajax.reload()})},500):Swal.fire("Error","There was an issue sending the credentials.","error")},error:function(){Swal.fire("Error","There was an issue with the request.","error")},complete:function(){$("#send-email-loader").addClass("hidden"),$("body").removeClass("no-scroll")}}):($("#send-email-loader").addClass("hidden"),$("body").removeClass("no-scroll"))})})}$("#add-admin-btn").on("click",function(){$("#add-admin-modal").show(),$("body").addClass("no-scroll")}),$("#close-btn-add-admin").on("click",function(){$("#add-admin-modal").fadeOut(),$("body").removeClass("no-scroll")}),$("#add-admin-list-btn").on("click",function(){$("#add-admin-list-modal").show(),$("body").addClass("no-scroll")}),$("#close-btn-add-admin-list").on("click",function(){$("#add-admin-list-modal").fadeOut(),$("body").removeClass("no-scroll")});function l(){$.ajax({url:"/get-branches",method:"GET",success:function(a){const i=$("#branch");i.empty(),i.append("<option value=''>Select PUP Branch</option>"),a.branches.forEach(function(r){i.append(`<option value="${r.branchID}">${r.branchDescription}</option>`)})},error:function(a){console.error("Error fetching branches:",a)}})}l()});$(document).on("click",".fa-eye",function(){const s=this.getAttribute("data-salutation"),l=this.getAttribute("data-fname"),c=this.getAttribute("data-lname"),m=this.getAttribute("data-mname"),a=this.getAttribute("data-sname"),i=this.getAttribute("data-email"),r=this.getAttribute("data-schoolID"),t=this.getAttribute("data-branch");document.getElementById("view-salutation").textContent=s,document.getElementById("view-Fname").textContent=l,document.getElementById("view-Lname").textContent=c,document.getElementById("view-Mname").textContent,document.getElementById("view-Sname").textContent,document.getElementById("view-email").textContent=i,document.getElementById("view-schoolIDNo").textContent,document.getElementById("view-branch").textContent=t,$("#view-admin-modal").show(),$("body").addClass("no-scroll")});$("#close-btn-view-admin").on("click",function(){$("#view-admin-modal").fadeOut(),$("body").removeClass("no-scroll")});$("#close-btn-edit-admin").on("click",function(){$("#edit-admin-modal").fadeOut(),$("body").removeClass("no-scroll")});$(document).on("click",".edit-button",function(){const s=$(this).data();$("#edit-admin-modal #edit-adminID").val(s.adminid),$("#edit-admin-modal #edit-Fname").val(s.fname),$("#edit-admin-modal #edit-Lname").val(s.lname),$("#edit-admin-modal #edit-Mname").val(s.mname),$("#edit-admin-modal #edit-Sname").val(s.sname),$("#edit-admin-modal #edit-schoolIDNo").val(s.schoolid),$("#edit-admin-modal #edit-email").val(s.email),$("#edit-admin-modal #edit-salutation").val(s.salutation),$("#edit-admin-modal").show(),$("body").addClass("no-scroll")});
