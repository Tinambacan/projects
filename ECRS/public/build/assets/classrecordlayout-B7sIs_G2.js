$(document).ready(function(){let d=null;function b(s,e){const r=`/faculty/class-record/${s.replace(/\s+/g,"-")}/${e}`;window.location.href=r}function l(s,e){return new Promise((t,r)=>{const a=`/get-assessments/${s}/${e}`;$.ajax({url:a,type:"GET",success:function(o){if($("#section-selector").empty().data("term",e),Array.isArray(o)&&o.length>0){o.forEach(g=>{const u=g.toLowerCase();$("#section-selector").append(`<option value="${u}">${g}</option>`)}),$("#section-selector").append('<option value="student-grades">Grades</option>');const i=o[0].toLowerCase();t(i)}else console.warn("No assessments found or invalid response."),$("#section-selector").append("<option disabled>No assessments available</option>"),t(null)},error:function(o){console.error("Error fetching assessments:",o),r(o)}})})}function m(s,e,t){c!=="student-info"&&$.ajax({url:"/get-assessment-type",type:"GET",success:function(r){const a=r.assessmentType;r.selectedTab;const i=localStorage.getItem("currentAssessmentType")||a||t;$("#section-selector").val(i),localStorage.setItem("currentAssessmentType",i)},error:function(r){console.error("Error fetching assessment type from session:",r)}})}const n=window.location.pathname.split("/"),c=n[n.length-1],C=n[n.length-2];if(c==="details"){const s=n[n.length-3],e=$(`[data-type="${s}"]`);if(e.length){e.addClass("bg-red-900 text-white  font-bold border-red-900 dark:bg-[#CCAA2C] dark:border-[#CCAA2C]"),e.removeClass("bg-white");const t=e.data("term"),r=e.data("class-record-id");l(r,t).then(a=>{m(r,t,a)})}}else{const s=$(`[data-type="${C}"]`);if(s.length){s.addClass("bg-red-900 text-white  font-bold border-red-900 dark:bg-[#CCAA2C] dark:border-[#CCAA2C]"),s.removeClass("bg-white");const e=s.data("term"),t=s.data("class-record-id");l(t,e).then(r=>{m(t,e,r)})}else if(c==="student-info"){const e=$('[data-type="student-info"]');e.addClass("bg-red-900 text-white font-bold border-red-900 dark:bg-[#CCAA2C] dark:border-[#CCAA2C]"),e.removeClass("bg-white")}else{$("#sem-grade-tab").removeClass("hidden");const e=$('[data-type="semester-grade"]');e.addClass("bg-red-900 text-white  font-bold border-red-900 dark:bg-[#CCAA2C] dark:border-[#CCAA2C]"),e.removeClass("bg-white")}}if(c==="grades"){const s=n[n.length-2],e=$(`[data-type="${s}"]`);if($("#sem-grade-tab").removeClass("hidden"),e.length){e.addClass("bg-red-900 dark:text-white text-black font-bold border-red-900 dark:bg-[#CCAA2C] dark:border-[#CCAA2C]");const t=e.data("term"),r=e.data("class-record-id");l(r,t).then(a=>{m(r,t,a)})}}else c==="semester-grade"&&($("#sem-grade-tab").removeClass("hidden"),$('[data-type="semester-grade"]').addClass("bg-red-900 text-white  font-bold border-red-900 dark:bg-[#CCAA2C] dark:border-[#CCAA2C]"));$("#section-selector").on("change",function(){const s=$(this).val(),e=$(this).data("term"),t=window.location.pathname.split("/"),a=t[t.length-1]==="details"?t[t.length-3]:t[t.length-2];s==="student-grades"?(window.location.href=`/faculty/class-record/${a}/grades`,d=s,localStorage.setItem("currentAssessmentType",d),$.ajax({url:"/store-assessment-type",type:"POST",data:{assessmentType:d,term:e,selectedTab:a,_token:$('meta[name="csrf-token"]').attr("content")},success:function(o){},error:function(o){console.error("Error storing assessment type:",o)}})):(d=s,localStorage.setItem("currentAssessmentType",d),$.ajax({url:"/store-assessment-type",type:"POST",data:{assessmentType:d,term:e,selectedTab:a,_token:$('meta[name="csrf-token"]').attr("content")},success:function(o){b(a,d)},error:function(o){console.error("Error storing assessment type:",o)}}))}),$(".tab div").on("click",function(s){s.preventDefault(),$(".tab div").removeClass("bg-red-900 text-white font-bold border-red-900 dark:bg-[#CCAA2C] dark:border-[#CCAA2C] dark:bg-white"),$(".tab div").addClass("bg-white dark:bg-[#404040]");const e=$(this).data("type"),t=$(this).data("term"),r=$(this).data("class-record-id");$(this).addClass("bg-red-900 text-white  font-bold border-red-900 dark:bg-[#CCAA2C] dark:border-[#CCAA2C]"),$(this).removeClass("bg-white dark:bg-[#404040]"),e==="student-info"?window.location.href="/faculty/class-record/student-info":e==="semester-grade"?window.location.href="/faculty/class-record/semester-grade":l(r,t).then(a=>{$("#section-selector").val(a),localStorage.setItem("currentAssessmentType",a),$.ajax({url:"/store-assessment-type",type:"POST",data:{assessmentType:a,term:t,selectedTab:e,_token:$('meta[name="csrf-token"]').attr("content")},success:function(){b(e,a)},error:function(o){console.error("Error storing assessment type:",o)}})})})});
