$(document).ready(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.ajax({url:"/get-distribution-type",method:"GET",success:function(e){const{gradingTerm:o,selectedTab:t}=e;o&&t&&$("#section-selector option").each(function(){const s=$(this).data("term"),r=$(this).val();s==o&&r==t&&$(this).prop("selected",!0)})},error:function(e){console.error("Error fetching session data:",e)}});function u(e){const t=`/student/class-record/${e.replace(/\s+/g,"-")}`.toLowerCase();window.location.href=t}$("#section-selector").on("change",function(){const e=$(this).find(":selected"),o=e.val(),t=e.data("term");$.ajax({url:"/store-distribution-type",type:"POST",data:{term:t,selectedTab:o,_token:$('meta[name="csrf-token"]').attr("content")},success:function(s){u(o)},error:function(s){console.error("Error storing assessment type:",s)}})}),$("#feedback-btn").on("click",function(){$(this).data("assessments")===0?Swal.fire({icon:"warning",title:"No assessment found",text:"No assessment found to feedback.",confirmButtonColor:"#CCAA2C"}):($("#feedback-modal").show(),$("body").addClass("no-scroll"))}),$("#close-btn-feedback").on("click",function(){$("#feedback-modal").fadeOut(),$("body").removeClass("no-scroll")}),$("#send-request-btn").click(function(){var e=$("#professor-id").val();$.ajax({url:"/send-notification",type:"POST",data:{professor_id:e},success:function(o){},error:function(o,t,s){console.error("Error sending notification:",s)}})});function f(e,o,t){$(e).on("input",function(){const s=$(this).val().length,r=t-s;$(o).text(r),s>=t&&$(this).val($(this).val().substring(0,t))})}f("#body","#char-count",50),$("#feedback-form").on("submit",function(e){$("#send-feedback-st").show(),e.preventDefault();const o=$("#subject").val(),t=$("#body").val(),s=$("#professor-id").val(),r=$('input[name="_token"]').val();$.ajax({url:"/store-feedback",type:"POST",data:{_token:r,subject:o,body:t,loginID:s},success:function(n){$("#send-feedback-st").fadeOut(),$("#feedback-modal").fadeOut(),Swal.fire({icon:"success",title:"Success",text:n.message,showConfirmButton:!1,timer:2e3}).then(()=>{$("#feedback-form")[0].reset(),$("#char-count").text(50),$("body").removeClass("no-scroll")})},error:function(n){if($("#send-feedback-st").fadeOut(),n.status===422){const i=n.responseJSON,a=Object.values(i.errors).map(d=>d[0]).join(`
`);Swal.fire({icon:"error",title:"Validation Error",text:a})}else Swal.fire({icon:"error",title:"Error",text:"There was an error submitting your feedback. Please try again."})}})}),$(document).ready(function(){$("#print-scores-btn").on("click",function(e){$(this).data("assessments")===0?Swal.fire({icon:"warning",title:"No assessment found",text:"No assessment found to print",confirmButtonColor:"#CCAA2C"}):(e.preventDefault(),Swal.fire({title:"Confirmation",text:"You are about to print the scores.",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes"}).then(t=>{t.isConfirmed&&($("#print-score-st").removeClass("hidden"),$.ajax({url:"/export-student-assessments",method:"GET",xhrFields:{responseType:"blob"},success:function(s,r,n){const i=n.getResponseHeader("Content-Disposition");let a="exported-scores.pdf";if(i){const l=/filename="([^"]*)"/.exec(i);l!=null&&l[1]&&(a=l[1])}const d=new Blob([s],{type:n.getResponseHeader("Content-Type")}),c=document.createElement("a");c.href=window.URL.createObjectURL(d),c.download=a,document.body.appendChild(c),c.click(),document.body.removeChild(c),$("#print-score-st").addClass("hidden"),Swal.fire({title:"Success!",text:"The scores have been printed successfully.",icon:"success",confirmButtonColor:"#3085d6"})},error:function(){Swal.fire({title:"Error!",text:"Something went wrong while printing the scores.",icon:"error",confirmButtonColor:"#d33"})}}))}))})})});
